"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"FormConfirmation",{enumerable:!0,get:function(){return _FormElements.FormConfirmation}}),Object.defineProperty(exports,"FormError",{enumerable:!0,get:function(){return _FormElements.FormError}}),Object.defineProperty(exports,"RenderFields",{enumerable:!0,get:function(){return _FormElements.RenderFields}}),Object.defineProperty(exports,"Submit",{enumerable:!0,get:function(){return _FormElements.Submit}}),exports.default=void 0,Object.defineProperty(exports,"validateField",{enumerable:!0,get:function(){return _validation.validateField}});var _react=_interopRequireWildcard(require("react")),_isomorphicUnfetch=_interopRequireDefault(require("isomorphic-unfetch")),_FormElements=require("./FormElements"),_form=require("./Helpers/form"),_validation=require("./Helpers/validation"),_jsxRuntime=require("react/jsx-runtime");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(b,c){if(!c&&b&&b.__esModule)return b;if(null===b||"object"!=typeof b&&"function"!=typeof b)return{default:b};var d=_getRequireWildcardCache(c);if(d&&d.has(b))return d.get(b);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in b)if("default"!=a&&Object.prototype.hasOwnProperty.call(b,a)){var g=f?Object.getOwnPropertyDescriptor(b,a):null;g&&(g.get||g.set)?Object.defineProperty(e,a,g):e[a]=b[a]}return e.default=b,d&&d.set(b,e),e}const GravityForm=a=>{var b;const{initialPage:c,populatedEntry:d,onChange:e}=a,[f,g]=(0,_react.useState)(!1),[h,i]=(0,_react.useState)(!1),[j,k]=(0,_react.useState)({}),[l,m]=(0,_react.useState)(!1),[n,o]=(0,_react.useState)(!1),[p,q]=(0,_react.useState)(!1),[r,s]=(0,_react.useState)({}),[t,u]=(0,_react.useState)({}),[v,w]=(0,_react.useState)(c||1),[x,y]=(0,_react.useState)({}),[z,A]=(0,_react.useState)({}),[B,C]=(0,_react.useState)(!1),[D,E]=(0,_react.useState)(!1),[F,G]=(0,_react.useState)(!1),[H,I]=(0,_react.useState)({}),J=(0,_react.useRef)(null),K=(0,_react.useCallback)(a=>{(0,_form.updateFieldsValuesBasedOnEntry)(a)},[]);(0,_react.useEffect)(()=>{(0,_form.fetchForm)({setFormData:s,setFormValues:k,setActivePage:w,setConditionFields:y,setConditionalIds:A,setPages:I,setIsMultiPart:C,...a})},[]),(0,_react.useEffect)(()=>{e&&e(j)},[j]),(0,_react.useEffect)(()=>{d&&K(d)},[d]);const L=()=>{if(J){const a=J.current.querySelector(".form-field.error");a&&a.scrollIntoView()}},{title:M,formID:N,submitIcon:O,saveStateToHtmlField:P,styledComponents:Q,customComponents:R,errorMessage:S,dropzoneText:T,loadingSpinner:U,onError:V,language:W,apiKeys:X}=a,{Button:Y,Loading:Z,FormError:$,FormConfirmation:_,GFWrapper:aa="div"}=Q||!1,{cssClass:ba,button:{conditionalLogic:ca}={}}=r||{},da=ca&&(0,_form.checkConditionalLogic)(ca,0<Object.keys(j).length?j:r.fields),ea=a=>{a.preventDefault(),(0,_form.prevStep)(j,H,v,w,E)},fa=async b=>{const{onSubmit:c,filterFormData:d}=a;let e=new FormData(b.target);d&&(e=d(e,j)),b.preventDefault();const f=(0,_form.forceValidation)(v,j,G,u);if(!f)return L(),!1;if(c)c(e);else{m(!0),o(!1),g(!1),q(!1),i(!1);const{formID:b,backendUrl:c,jumpToConfirmation:d,onSubmitSuccess:f,onError:h}=a,j=c.substring(0,c.indexOf("/wp-json"));(0,_isomorphicUnfetch.default)(`${j}/wp-json/gf/v2/forms/${b}/submissions`,{method:"POST",body:e}).then(a=>a.json()).then(b=>{if(b&&b.is_valid){if(f){const a=f(b);if(!a)return!1}const c=b.confirmation_message,{confirmation_type:e,confirmation_redirect:g}=b||!1;if(e&&g&&"redirect"===e&&"undefined"!=typeof window)return window.location.replace(g),!1;m(!1),o(!0),q(c),d&&(0,_form.scrollToConfirmation)(a,J,d)}else throw{response:b}}).catch(b=>{const c=b&&b.response&&b.response.validation_messages?b.response.validation_messages:"Something went wrong";h?(h(c),m(!1),g(!0)):(m(!1),g(!0),i(c)),d&&(0,_form.scrollToConfirmation)(a,J)})}};return(0,_jsxRuntime.jsxs)(aa,{ref:J,className:"form-wrapper",id:`gravity_form_${N}`,children:[r.title?null:Z&&(0,_jsxRuntime.jsx)(Z,{isLoading:!0}),f&&!n&&!V&&(0,_jsxRuntime.jsx)(_FormElements.FormError,{SFormError:$||!1,errorMessage:S||"There was a problem with your submission"}),n&&p&&(0,_jsxRuntime.jsx)(_FormElements.FormConfirmation,{confirmation:p,SFormConfirmation:_}),!n&&r.fields?(0,_jsxRuntime.jsxs)("form",{onSubmit:a=>fa(a),className:ba,encType:B?"multipart/form-data":void 0,noValidate:!0,children:[(r.title||r.description)&&(0,_jsxRuntime.jsxs)("div",{children:[r.title&&M?(0,_jsxRuntime.jsx)("h3",{className:"form-title",children:r.title}):null,r.description?(0,_jsxRuntime.jsx)("p",{className:"form-description",children:r.description}):null]}),(0,_jsxRuntime.jsxs)("div",{className:"form-wrapper",children:[(null===r||void 0===r||null===(b=r.pagination)||void 0===b?void 0:b.pages)&&(0,_jsxRuntime.jsx)(_FormElements.ProgressBar,{pagination:r.pagination,activePage:v,firstPageCssClass:r.firstPageCssClass}),(0,_jsxRuntime.jsx)(_FormElements.RenderFields,{styledComponents:Q,customComponents:R,fields:r.fields,formValues:j,submitFailed:f,submitSuccess:n,updateForm:(a,b,c)=>(0,_form.updateFormHandler)(b,a,c,j,k,z,x),touched:t,setTouched:a=>(0,_form.setTouchedHandler)(a,t,u),setErrorMessages:i,pagination:r.pagination,activePage:v,prevStep:a=>ea(a),nextStep:b=>(0,_form.nextStep)(b,a,H,j,v,w,E,u,G),checkConditionalLogic:(a,b)=>(0,_form.checkConditionalLogic)(a,b=!1),saveStateToHtmlField:P,enableHoneypot:r.enableHoneypot,errors:h,unsetError:a=>(0,_form.unsetError)(a,h),dropzoneText:T,pageClicked:D,language:W,apiKeys:X,...a}),(!r.pagination||r.pagination&&r.pagination.pages.length===v)&&(0,_jsxRuntime.jsx)(_FormElements.Submit,{Button:Y,Loading:Z,formData:r,submitIcon:O,submitting:l,prevStep:a=>ea(a),loadingSpinner:U,hideSubmitButton:da})]})]}):""]})};GravityForm.defaultProps={title:!0,submitIcon:!1,saveStateToHtmlField:!1,jumpToConfirmation:!0};var _default=exports.default=GravityForm;