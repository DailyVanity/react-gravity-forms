"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validateField = exports.isRequired = exports.isEmail = exports.isUrl = exports.checkboxValidation = exports.selectValidation = exports.isEmpty = void 0;

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

var getMessage = function getMessage(message, type) {
  if (!type) return false;

  if (message && _typeof(message) === "object" && message[type]) {
    return message[type];
  }

  return message;
};

var isEmail = function isEmail(email, message) {
  var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

  if (!re.test(email)) {
    var customMessage = getMessage(message, "email");
    return customMessage || "Enter a valid email";
  }

  return false;
};

exports.isEmail = isEmail;

var isUrl = function isUrl(str, message) {
  var pattern = new RegExp("^(https?:\\/\\/)?" + // protocol
  "((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|" + // domain name
  "((\\d{1,3}\\.){3}\\d{1,3}))" + // OR ip (v4) address
  "(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*" + // port and path
  "(\\?[;&a-z\\d%_.~+=-]*)?" + // query string
  "(\\#[-a-z\\d_]*)?$", "i"); // fragment locator

  if (!pattern.test(str)) {
    var customMessage = getMessage(message, "url");
    return customMessage || "Enter a valid url";
  }

  return false;
};

exports.isUrl = isUrl;

var isEmpty = function isEmpty(value) {
  if (!value) {
    return true;
  }

  return false;
};

exports.isEmpty = isEmpty;

var isRequired = function isRequired(required, empty, message) {
  if (required && empty) {
    var customMessage = getMessage(message, "required");
    return customMessage || "This field is required";
  }

  return false;
};

exports.isRequired = isRequired;

var selectValidation = function selectValidation(required, value, placeholder) {
  return !(value === placeholder && required);
};

exports.selectValidation = selectValidation;

var checkboxValidation = function checkboxValidation(values, message) {
  if (values.length < 1) {
    return message || "This field is required";
  }

  return false;
};

exports.checkboxValidation = checkboxValidation;

var passwordValidation = function passwordValidation(values, field) {
  var _ref = field || false,
      inputs = _ref.inputs,
      required = _ref.isRequired,
      errorMessage = _ref.errorMessage;

  var _ref2 = errorMessage || false,
      requiredMsg = _ref2.required,
      mismatch = _ref2.mismatch; // check if fields is required and isn't empty


  var isInputsEmpty = values && values.filter(function (item) {
    return item && item.val === "";
  }).length;

  if ((values && values.length === 0 || isInputsEmpty === inputs.length) && required) {
    return requiredMsg || "This field is required";
  } // if there is repeat password field => check if match


  if (values && values.length === 2 && inputs && inputs.length === 2) {
    if (values[1] && values[0] && values[1].val !== "" && values[1].val !== values[0].val) {
      return mismatch || "Mismatch";
    }
  }

  return false;
};

var isDate = function isDate(values, field) {
  var validation = [];

  for (var i = 0; i < values.length; i++) {
    if (values[i]) {
      var _values$i = values[i],
          val = _values$i.val,
          label = _values$i.label;

      if (val) {
        if (label === "MM") {
          var max = 12;
          var min = 1;
          var maxLength = 2;

          if (val.length > maxLength || val < min || val > max) {
            validation[i] = {
              index: i,
              message: "Enter a valid month"
            };
          }
        } else if (label === "DD") {
          var _max = 31;
          var _min = 1;
          var _maxLength = 2;

          if (val.length > _maxLength || val < _min || val > _max) {
            validation[i] = {
              index: i,
              message: "Enter a valid date"
            };
          }
        } else if (label === "YYYY") {
          var _max2 = new Date().getFullYear() + 1;

          var _min2 = 1920;
          var _maxLength2 = 4;

          if (val.length > _maxLength2 || val < _min2 || val > _max2) {
            validation[i] = {
              index: i,
              message: "Enter a valid year"
            };
          }
        }
      }
    }
  }

  return validation;
};

var validateField = function validateField(value, field) {
  var type = field.type,
      required = field.isRequired; // Check first if requried checkbox or radio

  if ((type === "checkbox" || type === "radio") && required) {
    return checkboxValidation(value, field.errorMessage);
  }

  if (type === "password") {
    return passwordValidation(value, field);
  } // Check if empty


  var empty = isEmpty(value);
  var validationMessage = "";
  var message = field && field.errorMessage ? field.errorMessage : false; // Set validation message if required

  validationMessage = required ? isRequired(required, empty, message) : false; // Set other validation messages

  if (!validationMessage && !empty) {
    if (type === "email") {
      validationMessage = isEmail(value, message);
    } else if (type === "website") {
      validationMessage = isUrl(value, message);
    } else if (type === "date") {
      var isValid = true;

      if (field.dateType && field.dateType === "datepicker") {
        isValid = required ? isRequired(required, empty, message) : false;
      } else {
        isValid = isDate(value, field);
      }

      validationMessage = isValid.length > 0 ? isValid : false;
    }
  }

  return validationMessage;
};

exports.validateField = validateField;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9IZWxwZXJzL3ZhbGlkYXRpb24uanMiXSwibmFtZXMiOlsiZ2V0TWVzc2FnZSIsIm1lc3NhZ2UiLCJ0eXBlIiwiaXNFbWFpbCIsImVtYWlsIiwicmUiLCJ0ZXN0IiwiY3VzdG9tTWVzc2FnZSIsImlzVXJsIiwic3RyIiwicGF0dGVybiIsIlJlZ0V4cCIsImlzRW1wdHkiLCJ2YWx1ZSIsImlzUmVxdWlyZWQiLCJyZXF1aXJlZCIsImVtcHR5Iiwic2VsZWN0VmFsaWRhdGlvbiIsInBsYWNlaG9sZGVyIiwiY2hlY2tib3hWYWxpZGF0aW9uIiwidmFsdWVzIiwibGVuZ3RoIiwicGFzc3dvcmRWYWxpZGF0aW9uIiwiZmllbGQiLCJpbnB1dHMiLCJlcnJvck1lc3NhZ2UiLCJyZXF1aXJlZE1zZyIsIm1pc21hdGNoIiwiaXNJbnB1dHNFbXB0eSIsImZpbHRlciIsIml0ZW0iLCJ2YWwiLCJpc0RhdGUiLCJ2YWxpZGF0aW9uIiwiaSIsImxhYmVsIiwibWF4IiwibWluIiwibWF4TGVuZ3RoIiwiaW5kZXgiLCJEYXRlIiwiZ2V0RnVsbFllYXIiLCJ2YWxpZGF0ZUZpZWxkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJpc1ZhbGlkIiwiZGF0ZVR5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLElBQU1BLFVBQVUsR0FBRyxTQUFiQSxVQUFhLENBQUNDLE9BQUQsRUFBVUMsSUFBVixFQUFtQjtBQUNwQyxNQUFJLENBQUNBLElBQUwsRUFBVyxPQUFPLEtBQVA7O0FBQ1gsTUFBSUQsT0FBTyxJQUFJLFFBQU9BLE9BQVAsTUFBbUIsUUFBOUIsSUFBMENBLE9BQU8sQ0FBQ0MsSUFBRCxDQUFyRCxFQUE2RDtBQUMzRCxXQUFPRCxPQUFPLENBQUNDLElBQUQsQ0FBZDtBQUNEOztBQUNELFNBQU9ELE9BQVA7QUFDRCxDQU5EOztBQVFBLElBQU1FLE9BQU8sR0FBRyxTQUFWQSxPQUFVLENBQUNDLEtBQUQsRUFBUUgsT0FBUixFQUFvQjtBQUNsQyxNQUFNSSxFQUFF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MUIsVUFBSTBDLE9BQU8sR0FBRyxJQUFkOztBQUNBLFVBQUlyQixLQUFLLENBQUNzQixRQUFOLElBQWtCdEIsS0FBSyxDQUFDc0IsUUFBTixLQUFtQixZQUF6QyxFQUF1RDtBQUNyREQsUUFBQUEsT0FBTyxHQUFHN0IsUUFBUSxHQUFHRCxVQUFVLENBQUNDLFFBQUQsRUFBV0MsS0FBWCxFQUFrQmYsT0FBbEIsQ0FBYixHQUEwQyxLQUE1RDtBQUNELE9BRkQsTUFFTztBQUNMMkMsUUFBQUEsT0FBTyxHQUFHWixNQUFNLENBQUNuQixLQUFELEVBQVFVLEtBQVIsQ0FBaEI7QUFDRDs7QUFDRG9CLE1BQUFBLGlCQUFpQixHQUFHQyxPQUFPLENBQUN2QixNQUFSLEdBQWlCLENBQWpCLEdBQXFCdUIsT0FBckIsR0FBK0IsS0FBbkQ7QUFDRDtBQUNGOztBQUNELFNBQU9ELGlCQUFQO0FBQ0QsQ0FsQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnZXRNZXNzYWdlID0gKG1lc3NhZ2UsIHR5cGUpID0+IHtcbiAgaWYgKCF0eXBlKSByZXR1cm4gZmFsc2U7XG4gIGlmIChtZXNzYWdlICYmIHR5cGVvZiBtZXNzYWdlID09PSBcIm9iamVjdFwiICYmIG1lc3NhZ2VbdHlwZV0pIHtcbiAgICByZXR1cm4gbWVzc2FnZVt0eXBlXTtcbiAgfVxuICByZXR1cm4gbWVzc2FnZTtcbn07XG5cbmNvbnN0IGlzRW1haWwgPSAoZW1haWwsIG1lc3NhZ2UpID0+IHtcbiAgY29uc3QgcmUgPSAvXigoW148PigpXFxbXFxdXFxcXC4sOzpcXHNAXCJdKyhcXC5bXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKSopfChcIi4rXCIpKUAoKFxcW1swLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31dKXwoKFthLXpBLVpcXC0wLTldK1xcLikrW2EtekEtWl17Mix9KSkkLztcbiAgaWYgKCFyZS50ZXN0KGVtYWlsKSkge1xuICAgIGNvbnN0IGN1c3RvbU1lc3NhZ2UgPSBnZXRNZXNzYWdlKG1lc3NhZ2UsIFwiZW1haWxcIik7XG4gICAgcmV0dXJuIGN1c3RvbU1lc3NhZ2UgfHwgXCJFbnRlciBhIHZhbGlkIGVtYWlsXCI7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuY29uc3QgaXNVcmwgPSAoc3RyLCBtZXNzYWdlKSA9PiB7XG4gIGNvbnN0IHBhdHRlcm4gPSBuZXcgUmVnRXhwKFxuICAgIFwiXihodHRwcz86XFxcXC9cXFxcLyk/XCIgKyAvLyBwcm90b2NvbFxuICAgIFwiKCgoW2EtelxcXFxkXShbYS16XFxcXGQtXSpbYS16XFxcXGRdKSopXFxcXC4pK1thLXpdezIsfXxcIiArIC8vIGRvbWFpbiBuYW1lXG4gICAgXCIoKFxcXFxkezEsM31cXFxcLil7M31cXFxcZHsxLDN9KSlcIiArIC8vIE9SIGlwICh2NCkgYWRkcmVzc1xuICAgIFwiKFxcXFw6XFxcXGQrKT8oXFxcXC9bLWEtelxcXFxkJV8ufitdKikqXCIgKyAvLyBwb3J0IGFuZCBwYXRoXG4gICAgXCIoXFxcXD9bOyZhLXpcXFxcZCVfLn4rPS1dKik/XCIgKyAvLyBxdWVyeSBzdHJpbmdcbiAgICAgIFwiKFxcXFwjWy1hLXpcXFxcZF9dKik/JFwiLFxuICAgIFwiaVwiXG4gICk7IC8vIGZyYWdtZW50IGxvY2F0b3JcbiAgaWYgKCFwYXR0ZXJuLnRlc3Qoc3RyKSkge1xuICAgIGNvbnN0IGN1c3RvbU1lc3NhZ2UgPSBnZXRNZXNzYWdlKG1lc3NhZ2UsIFwidXJsXCIpO1xuICAgIHJldHVybiBjdXN0b21NZXNzYWdlIHx8IFwiRW50ZXIgYSB2YWxpZCB1cmxcIjtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5jb25zdCBpc0VtcHR5ID0gdmFsdWUgPT4ge1xuICBpZiAoIXZhbHVlKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuY29uc3QgaXNSZXF1aXJlZCA9IChyZXF1aXJlZCwgZW1wdHksIG1lc3NhZ2UpID0+IHtcbiAgaWYgKHJlcXVpcmVkICYmIGVtcHR5KSB7XG4gICAgY29uc3QgY3VzdG9tTWVzc2FnZSA9IGdldE1lc3NhZ2UobWVzc2FnZSwgXCJyZXF1aXJlZFwiKTtcbiAgICByZXR1cm4gY3VzdG9tTWVzc2FnZSB8fCBcIlRoaXMgZmllbGQgaXMgcmVxdWlyZWRcIjtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5jb25zdCBzZWxlY3RWYWxpZGF0aW9uID0gKHJlcXVpcmVkLCB2YWx1ZSwgcGxhY2Vob2xkZXIpID0+XG4gICEodmFsdWUgPT09IHBsYWNlaG9sZGVyICYmIHJlcXVpcmVkKTtcblxuY29uc3QgY2hlY2tib3hWYWxpZGF0aW9uID0gKHZhbHVlcywgbWVzc2FnZSkgPT4ge1xuICBpZiAodmFsdWVzLmxlbmd0aCA8IDEpIHtcbiAgICByZXR1cm4gbWVzc2FnZSB8fCBcIlRoaXMgZmllbGQgaXMgcmVxdWlyZWRcIjtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5jb25zdCBwYXNzd29yZFZhbGlkYXRpb24gPSAodmFsdWVzLCBmaWVsZCkgPT4ge1xuICBjb25zdCB7IGlucHV0cywgaXNSZXF1aXJlZDogcmVxdWlyZWQsIGVycm9yTWVzc2FnZSB9ID0gZmllbGQgfHwgZmFsc2U7XG4gIGNvbnN0IHsgcmVxdWlyZWQ6IHJlcXVpcmVkTXNnLCBtaXNtYXRjaCB9ID0gZXJyb3JNZXNzYWdlIHx8IGZhbHNlO1xuXG4gIC8vIGNoZWNrIGlmIGZpZWxkcyBpcyByZXF1aXJlZCBhbmQgaXNuJ3QgZW1wdHlcbiAgY29uc3QgaXNJbnB1dHNFbXB0eSA9XG4gICAgdmFsdWVzICYmIHZhbHVlcy5maWx0ZXIoaXRlbSA9PiBpdGVtICYmIGl0ZW0udmFsID09PSBcIlwiKS5sZW5ndGg7XG5cbiAgaWYgKFxuICAgICgodmFsdWVzICYmIHZhbHVlcy5sZW5ndGggPT09IDApIHx8IGlzSW5wdXRzRW1wdHkgPT09IGlucHV0cy5sZW5ndGgpICYmXG4gICAgcmVxdWlyZWRcbiAgKSB7XG4gICAgcmV0dXJuIHJlcXVpcmVkTXNnIHx8IFwiVGhpcyBmaWVsZCBpcyByZXF1aXJlZFwiO1xuICB9XG5cbiAgLy8gaWYgdGhlcmUgaXMgcmVwZWF0IHBhc3N3b3JkIGZpZWxkID0+IGNoZWNrIGlmIG1hdGNoXG4gIGlmICh2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aCA9PT0gMiAmJiBpbnB1dHMgJiYgaW5wdXRzLmxlbmd0aCA9PT0gMikge1xuICAgIGlmIChcbiAgICAgIHZhbHVlc1sxXSAmJlxuICAgICAgdmFsdWVzWzBdICYmXG4gICAgICB2YWx1ZXNbMV0udmFsICE9PSBcIlwiICYmXG4gICAgICB2YWx1ZXNbMV0udmFsICE9PSB2YWx1ZXNbMF0udmFsXG4gICAgKSB7XG4gICAgICByZXR1cm4gbWlzbWF0Y2ggfHwgXCJNaXNtYXRjaFwiO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cbmNvbnN0IGlzRGF0ZSA9ICh2YWx1ZXMsIGZpZWxkKSA9PiB7XG4gIGNvbnN0IHZhbGlkYXRpb24gPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodmFsdWVzW2ldKSB7XG4gICAgICBjb25zdCB7IHZhbCwgbGFiZWwgfSA9IHZhbHVlc1tpXTtcbiAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgaWYgKGxhYmVsID09PSBcIk1NXCIpIHtcbiAgICAgICAgICBjb25zdCBtYXggPSAxMjtcbiAgICAgICAgICBjb25zdCBtaW4gPSAxO1xuICAgICAgICAgIGNvbnN0IG1heExlbmd0aCA9IDI7XG4gICAgICAgICAgaWYgKHZhbC5sZW5ndGggPiBtYXhMZW5ndGggfHwgdmFsIDwgbWluIHx8IHZhbCA+IG1heCkge1xuICAgICAgICAgICAgdmFsaWRhdGlvbltpXSA9IHtcbiAgICAgICAgICAgICAgaW5kZXg6IGksXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRW50ZXIgYSB2YWxpZCBtb250aFwiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChsYWJlbCA9PT0gXCJERFwiKSB7XG4gICAgICAgICAgY29uc3QgbWF4ID0gMzE7XG4gICAgICAgICAgY29uc3QgbWluID0gMTtcbiAgICAgICAgICBjb25zdCBtYXhMZW5ndGggPSAyO1xuICAgICAgICAgIGlmICh2YWwubGVuZ3RoID4gbWF4TGVuZ3RoIHx8IHZhbCA8IG1pbiB8fCB2YWwgPiBtYXgpIHtcbiAgICAgICAgICAgIHZhbGlkYXRpb25baV0gPSB7XG4gICAgICAgICAgICAgIGluZGV4OiBpLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBcIkVudGVyIGEgdmFsaWQgZGF0ZVwiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChsYWJlbCA9PT0gXCJZWVlZXCIpIHtcbiAgICAgICAgICBjb25zdCBtYXggPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkgKyAxO1xuICAgICAgICAgIGNvbnN0IG1pbiA9IDE5MjA7XG4gICAgICAgICAgY29uc3QgbWF4TGVuZ3RoID0gNDtcbiAgICAgICAgICBpZiAodmFsLmxlbmd0aCA+IG1heExlbmd0aCB8fCB2YWwgPCBtaW4gfHwgdmFsID4gbWF4KSB7XG4gICAgICAgICAgICB2YWxpZGF0aW9uW2ldID0ge1xuICAgICAgICAgICAgICBpbmRleDogaSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogXCJFbnRlciBhIHZhbGlkIHllYXJcIlxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhbGlkYXRpb247XG59O1xuXG5jb25zdCB2YWxpZGF0ZUZpZWxkID0gKHZhbHVlLCBmaWVsZCkgPT4ge1xuICBjb25zdCB7IHR5cGUsIGlzUmVxdWlyZWQ6IHJlcXVpcmVkIH0gPSBmaWVsZDtcbiAgLy8gQ2hlY2sgZmlyc3QgaWYgcmVxdXJpZWQgY2hlY2tib3ggb3IgcmFkaW9cbiAgaWYgKCh0eXBlID09PSBcImNoZWNrYm94XCIgfHwgdHlwZSA9PT0gXCJyYWRpb1wiKSAmJiByZXF1aXJlZCkge1xuICAgIHJldHVybiBjaGVja2JveFZhbGlkYXRpb24odmFsdWUsIGZpZWxkLmVycm9yTWVzc2FnZSk7XG4gIH1cblxuICBpZiAodHlwZSA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgcmV0dXJuIHBhc3N3b3JkVmFsaWRhdGlvbih2YWx1ZSwgZmllbGQpO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgZW1wdHlcbiAgY29uc3QgZW1wdHkgPSBpc0VtcHR5KHZhbHVlKTtcbiAgbGV0IHZhbGlkYXRpb25NZXNzYWdlID0gXCJcIjtcbiAgY29uc3QgbWVzc2FnZSA9IGZpZWxkICYmIGZpZWxkLmVycm9yTWVzc2FnZSA/IGZpZWxkLmVycm9yTWVzc2FnZSA6IGZhbHNlO1xuICAvLyBTZXQgdmFsaWRhdGlvbiBtZXNzYWdlIGlmIHJlcXVpcmVkXG4gIHZhbGlkYXRpb25NZXNzYWdlID0gcmVxdWlyZWQgPyBpc1JlcXVpcmVkKHJlcXVpcmVkLCBlbXB0eSwgbWVzc2FnZSkgOiBmYWxzZTtcbiAgLy8gU2V0IG90aGVyIHZhbGlkYXRpb24gbWVzc2FnZXNcbiAgaWYgKCF2YWxpZGF0aW9uTWVzc2FnZSAmJiAhZW1wdHkpIHtcbiAgICBpZiAodHlwZSA9PT0gXCJlbWFpbFwiKSB7XG4gICAgICB2YWxpZGF0aW9uTWVzc2FnZSA9IGlzRW1haWwodmFsdWUsIG1lc3NhZ2UpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJ3ZWJzaXRlXCIpIHtcbiAgICAgIHZhbGlkYXRpb25NZXNzYWdlID0gaXNVcmwodmFsdWUsIG1lc3NhZ2UpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJkYXRlXCIpIHtcbiAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgIGlmIChmaWVsZC5kYXRlVHlwZSAmJiBmaWVsZC5kYXRlVHlwZSA9PT0gXCJkYXRlcGlja2VyXCIpIHtcbiAgICAgICAgaXNWYWxpZCA9IHJlcXVpcmVkID8gaXNSZXF1aXJlZChyZXF1aXJlZCwgZW1wdHksIG1lc3NhZ2UpIDogZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpc1ZhbGlkID0gaXNEYXRlKHZhbHVlLCBmaWVsZCk7XG4gICAgICB9XG4gICAgICB2YWxpZGF0aW9uTWVzc2FnZSA9IGlzVmFsaWQubGVuZ3RoID4gMCA/IGlzVmFsaWQgOiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhbGlkYXRpb25NZXNzYWdlO1xufTtcblxuZXhwb3J0IHtcbiAgaXNFbXB0eSxcbiAgc2VsZWN0VmFsaWRhdGlvbixcbiAgY2hlY2tib3hWYWxpZGF0aW9uLFxuICBpc1VybCxcbiAgaXNFbWFpbCxcbiAgaXNSZXF1aXJlZCxcbiAgdmFsaWRhdGVGaWVsZFxufTtcbiJdfQ==