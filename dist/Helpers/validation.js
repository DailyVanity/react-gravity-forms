"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validateField = exports.isRequired = exports.isEmail = exports.isUrl = exports.checkboxValidation = exports.selectValidation = exports.isEmpty = void 0;

var isEmail = function isEmail(email) {
  var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(email);
};

exports.isEmail = isEmail;

var isUrl = function isUrl(str) {
  var pattern = new RegExp('^(https?:\\/\\/)?' // protocol
  + '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' // domain name
  + '((\\d{1,3}\\.){3}\\d{1,3}))' // OR ip (v4) address
  + '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' // port and path
  + '(\\?[;&a-z\\d%_.~+=-]*)?' // query string
  + '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator

  return !!pattern.test(str);
};

exports.isUrl = isUrl;

var isEmpty = function isEmpty(value) {
  if (!value) {
    return true;
  }

  return false;
};

exports.isEmpty = isEmpty;

var isRequired = function isRequired(required, empty, message) {
  if (required && empty) {
    return message || 'This field is required';
  }

  return false;
};

exports.isRequired = isRequired;

var selectValidation = function selectValidation(required, value, placeholder) {
  return !(value === placeholder && required);
};

exports.selectValidation = selectValidation;

var checkboxValidation = function checkboxValidation(values, message) {
  if (values.length < 1) {
    return message || 'This field is required';
  }

  return false;
};

exports.checkboxValidation = checkboxValidation;

var passwordValidation = function passwordValidation(values, field) {
  var inputs = field.inputs,
      required = field.isRequired,
      minPasswordStrength = field.minPasswordStrength,
      errorMessage = field.errorMessage;
  var requiredMsg = errorMessage.required,
      mismatch = errorMessage.mismatch; // check if fields is required and isn't empty

  var isInputsEmpty = values && values.filter(function (item) {
    return item.val === '';
  }).length;

  if (isInputsEmpty === inputs.length && required) {
    return requiredMsg || 'This field is required';
  } // if there is repeat password field => check if match


  if (values && values.length === 2 && inputs && inputs.length === 2) {
    if (values[1].val !== values[0].val) {
      return mismatch || 'Mismatch';
    } // check form password strength
    // if (minPasswordStrength) {
    //   return gformPasswordStrength(values[0].val, values[1].val[1]);
    // }

  } // check form password strength
  // if (minPasswordStrength) {
  // }


  return false;
};

var isDate = function isDate(values, field) {
  var validation = [];

  for (var i = 0; i < values.length; i++) {
    if (values[i]) {
      var _values$i = values[i],
          val = _values$i.val,
          label = _values$i.label;

      if (val) {
        if (label === 'MM') {
          var max = 12;
          var min = 1;
          var maxLength = 2;

          if (val.length > maxLength || val < min || val > max) {
            validation[i] = {
              index: i,
              message: 'Enter a valid month'
            };
          }
        } else if (label === 'DD') {
          var _max = 31;
          var _min = 1;
          var _maxLength = 2;

          if (val.length > _maxLength || val < _min || val > _max) {
            validation[i] = {
              index: i,
              message: 'Enter a valid date'
            };
          }
        } else if (label === 'YYYY') {
          var _max2 = new Date().getFullYear() + 1;

          var _min2 = 1920;
          var _maxLength2 = 4;

          if (val.length > _maxLength2 || val < _min2 || val > _max2) {
            validation[i] = {
              index: i,
              message: 'Enter a valid year'
            };
          }
        }
      }
    }
  }

  return validation;
};

var validateField = function validateField(value, field) {
  var type = field.type,
      required = field.isRequired; // Check first if requried checkbox or radio

  if ((type === 'checkbox' || type === 'radio') && required) {
    return checkboxValidation(value, field.errorMessage);
  }

  if (type === 'password') {
    return passwordValidation(value, field);
  } // Check if empty


  var empty = isEmpty(value);
  var validationMessage = '';
  var message = field && field.errorMessage ? field.errorMessage : false; // Set validation message if required

  validationMessage = required ? isRequired(required, empty, message) : false; // Set other validation messages

  if (!validationMessage && !empty) {
    if (type == 'email') {
      validationMessage = isEmail(value) ? false : field.errorMessage ? field.errorMessage : 'Enter a valid email';
    } else if (type == 'website') {
      validationMessage = isUrl(value) ? false : field.errorMessage ? field.errorMessage : 'Enter a valid url';
    } else if (type == 'date') {
      var isValid = isDate(value, field);
      validationMessage = isValid.length > 0 ? isValid : false;
    }
  }

  return validationMessage;
};

exports.validateField = validateField;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9IZWxwZXJzL3ZhbGlkYXRpb24uanMiXSwibmFtZXMiOlsiaXNFbWFpbCIsImVtYWlsIiwicmUiLCJ0ZXN0IiwiaXNVcmwiLCJzdHIiLCJwYXR0ZXJuIiwiUmVnRXhwIiwiaXNFbXB0eSIsInZhbHVlIiwiaXNSZXF1aXJlZCIsInJlcXVpcmVkIiwiZW1wdHkiLCJtZXNzYWdlIiwic2VsZWN0VmFsaWRhdGlvbiIsInBsYWNlaG9sZGVyIiwiY2hlY2tib3hWYWxpZGF0aW9uIiwidmFsdWVzIiwibGVuZ3RoIiwicGFzc3dvcmRWYWxpZGF0aW9uIiwiZmllbGQiLCJpbnB1dHMiLCJtaW5QYXNzd29yZFN0cmVuZ3RoIiwiZXJyb3JNZXNzYWdlIiwicmVxdWlyZWRNc2ciLCJtaXNtYXRjaCIsImlzSW5wdXRzRW1wdHkiLCJmaWx0ZXIiLCJpdGVtIiwidmFsIiwiaXNEYXRlIiwidmFsaWRhdGlvbiIsImkiLCJsYWJlbCIsIm1heCIsIm1pbiIsIm1heExlbmd0aCIsImluZGV4IiwiRGF0ZSIsImdldEZ1bGxZZWFyIiwidmFsaWRhdGVGaWVsZCIsInR5cGUiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImlzVmFsaWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxJQUFNQSxPQUFPLEdBQUcsU0FBVkEsT0FBVSxDQUFDQyxLQUFELEVBQVc7QUFDekIsTUFBTUMsRUFBRSxHQUFHLHdKQUFYO0FBQ0EsU0FBT0EsRUFBRSxDQUFDQyxJQUFILENBQVFGLEtBQVIsQ0FBUDtBQUNELENBSEQ7Ozs7QUFLQSxJQUFNRyxLQUFLLEdBQUcsU0FBUkEsS0FBUSxDQUFDQyxHQUFELEVBQVM7QUFDckIsTUFBTUMsT0FBTyxHQUFHLElBQUlDLE1BQUosQ0FDZCxvQkFBb0I7QUFBcEIsSUFDRSxrREFERixDQUNxRDtBQURyRCxJQUVFLDZCQUZGLENBRWdDO0FBRmhDLElBR0UsaUNBSEYsQ0FHb0M7QUFIcEMsSUFJRSwwQkFKRixDQUk2QjtBQUo3QixJQUtJLG9CQU5VLEVBT2Qs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QnNDLENBaUJ0Qzs7QUFDQSxNQUFJLENBQUM2QixpQkFBRCxJQUFzQixDQUFDOUIsS0FBM0IsRUFBa0M7QUFDaEMsUUFBSTZCLElBQUksSUFBSSxPQUFaLEVBQXFCO0FBQ25CQyxNQUFBQSxpQkFBaUIsR0FBRzFDLE9BQU8sQ0FBQ1MsS0FBRCxDQUFQLEdBQ2hCLEtBRGdCLEdBRWhCVyxLQUFLLENBQUNHLFlBQU4sR0FDRUgsS0FBSyxDQUFDRyxZQURSLEdBRUUscUJBSk47QUFLRCxLQU5ELE1BTU8sSUFBSWtCLElBQUksSUFBSSxTQUFaLEVBQXVCO0FBQzVCQyxNQUFBQSxpQkFBaUIsR0FBR3RDLEtBQUssQ0FBQ0ssS0FBRCxDQUFMLEdBQ2hCLEtBRGdCLEdBRWhCVyxLQUFLLENBQUNHLFlBQU4sR0FDRUgsS0FBSyxDQUFDRyxZQURSLEdBRUUsbUJBSk47QUFLRCxLQU5NLE1BTUEsSUFBSWtCLElBQUksSUFBSSxNQUFaLEVBQW9CO0FBQ3pCLFVBQU1FLE9BQU8sR0FBR2IsTUFBTSxDQUFDckIsS0FBRCxFQUFRVyxLQUFSLENBQXRCO0FBQ0FzQixNQUFBQSxpQkFBaUIsR0FBR0MsT0FBTyxDQUFDekIsTUFBUixHQUFpQixDQUFqQixHQUFxQnlCLE9BQXJCLEdBQStCLEtBQW5EO0FBQ0Q7QUFDRjs7QUFDRCxTQUFPRCxpQkFBUDtBQUNELENBckNEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaXNFbWFpbCA9IChlbWFpbCkgPT4ge1xuICBjb25zdCByZSA9IC9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvO1xuICByZXR1cm4gcmUudGVzdChlbWFpbCk7XG59O1xuXG5jb25zdCBpc1VybCA9IChzdHIpID0+IHtcbiAgY29uc3QgcGF0dGVybiA9IG5ldyBSZWdFeHAoXG4gICAgJ14oaHR0cHM/OlxcXFwvXFxcXC8pPycgLy8gcHJvdG9jb2xcbiAgICArICcoKChbYS16XFxcXGRdKFthLXpcXFxcZC1dKlthLXpcXFxcZF0pKilcXFxcLikrW2Etel17Mix9fCcgLy8gZG9tYWluIG5hbWVcbiAgICArICcoKFxcXFxkezEsM31cXFxcLil7M31cXFxcZHsxLDN9KSknIC8vIE9SIGlwICh2NCkgYWRkcmVzc1xuICAgICsgJyhcXFxcOlxcXFxkKyk/KFxcXFwvWy1hLXpcXFxcZCVfLn4rXSopKicgLy8gcG9ydCBhbmQgcGF0aFxuICAgICsgJyhcXFxcP1s7JmEtelxcXFxkJV8ufis9LV0qKT8nIC8vIHF1ZXJ5IHN0cmluZ1xuICAgICAgKyAnKFxcXFwjWy1hLXpcXFxcZF9dKik/JCcsXG4gICAgJ2knLFxuICApOyAvLyBmcmFnbWVudCBsb2NhdG9yXG4gIHJldHVybiAhIXBhdHRlcm4udGVzdChzdHIpO1xufTtcblxuY29uc3QgaXNFbXB0eSA9ICh2YWx1ZSkgPT4ge1xuICBpZiAoIXZhbHVlKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuY29uc3QgaXNSZXF1aXJlZCA9IChyZXF1aXJlZCwgZW1wdHksIG1lc3NhZ2UpID0+IHtcbiAgaWYgKHJlcXVpcmVkICYmIGVtcHR5KSB7XG4gICAgcmV0dXJuIG1lc3NhZ2UgfHwgJ1RoaXMgZmllbGQgaXMgcmVxdWlyZWQnO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbmNvbnN0IHNlbGVjdFZhbGlkYXRpb24gPSAocmVxdWlyZWQsIHZhbHVlLCBwbGFjZWhvbGRlcikgPT4gISh2YWx1ZSA9PT0gcGxhY2Vob2xkZXIgJiYgcmVxdWlyZWQpO1xuXG5jb25zdCBjaGVja2JveFZhbGlkYXRpb24gPSAodmFsdWVzLCBtZXNzYWdlKSA9PiB7XG4gIGlmICh2YWx1ZXMubGVuZ3RoIDwgMSkge1xuICAgIHJldHVybiBtZXNzYWdlIHx8ICdUaGlzIGZpZWxkIGlzIHJlcXVpcmVkJztcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5jb25zdCBwYXNzd29yZFZhbGlkYXRpb24gPSAodmFsdWVzLCBmaWVsZCkgPT4ge1xuICBjb25zdCB7XG4gaW5wdXRzLCBpc1JlcXVpcmVkOiByZXF1aXJlZCwgbWluUGFzc3dvcmRTdHJlbmd0aCwgZXJyb3JNZXNzYWdlIFxufSA9IGZpZWxkO1xuICBjb25zdCB7IHJlcXVpcmVkOiByZXF1aXJlZE1zZywgbWlzbWF0Y2ggfSA9IGVycm9yTWVzc2FnZTtcblxuICAvLyBjaGVjayBpZiBmaWVsZHMgaXMgcmVxdWlyZWQgYW5kIGlzbid0IGVtcHR5XG4gIGNvbnN0IGlzSW5wdXRzRW1wdHkgPSB2YWx1ZXMgJiYgdmFsdWVzLmZpbHRlcihpdGVtID0+IGl0ZW0udmFsID09PSAnJykubGVuZ3RoO1xuICBpZiAoaXNJbnB1dHNFbXB0eSA9PT0gaW5wdXRzLmxlbmd0aCAmJiByZXF1aXJlZCkge1xuICAgIHJldHVybiByZXF1aXJlZE1zZyB8fCAnVGhpcyBmaWVsZCBpcyByZXF1aXJlZCc7XG4gIH1cblxuICAvLyBpZiB0aGVyZSBpcyByZXBlYXQgcGFzc3dvcmQgZmllbGQgPT4gY2hlY2sgaWYgbWF0Y2hcbiAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoID09PSAyICYmIGlucHV0cyAmJiBpbnB1dHMubGVuZ3RoID09PSAyKSB7XG4gICAgaWYgKHZhbHVlc1sxXS52YWwgIT09IHZhbHVlc1swXS52YWwpIHtcbiAgICAgIHJldHVybiBtaXNtYXRjaCB8fCAnTWlzbWF0Y2gnO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGZvcm0gcGFzc3dvcmQgc3RyZW5ndGhcbiAgICAvLyBpZiAobWluUGFzc3dvcmRTdHJlbmd0aCkge1xuICAgIC8vICAgcmV0dXJuIGdmb3JtUGFzc3dvcmRTdHJlbmd0aCh2YWx1ZXNbMF0udmFsLCB2YWx1ZXNbMV0udmFsWzFdKTtcbiAgICAvLyB9XG4gIH1cblxuICAvLyBjaGVjayBmb3JtIHBhc3N3b3JkIHN0cmVuZ3RoXG4gIC8vIGlmIChtaW5QYXNzd29yZFN0cmVuZ3RoKSB7XG4gIC8vIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5jb25zdCBpc0RhdGUgPSAodmFsdWVzLCBmaWVsZCkgPT4ge1xuICBjb25zdCB2YWxpZGF0aW9uID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHZhbHVlc1tpXSkge1xuICAgICAgY29uc3QgeyB2YWwsIGxhYmVsIH0gPSB2YWx1ZXNbaV07XG4gICAgICBpZiAodmFsKSB7XG4gICAgICAgIGlmIChsYWJlbCA9PT0gJ01NJykge1xuICAgICAgICAgIGNvbnN0IG1heCA9IDEyO1xuICAgICAgICAgIGNvbnN0IG1pbiA9IDE7XG4gICAgICAgICAgY29uc3QgbWF4TGVuZ3RoID0gMjtcbiAgICAgICAgICBpZiAodmFsLmxlbmd0aCA+IG1heExlbmd0aCB8fCB2YWwgPCBtaW4gfHwgdmFsID4gbWF4KSB7XG4gICAgICAgICAgICB2YWxpZGF0aW9uW2ldID0ge1xuICAgICAgICAgICAgICBpbmRleDogaSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ0VudGVyIGEgdmFsaWQgbW9udGgnLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobGFiZWwgPT09ICdERCcpIHtcbiAgICAgICAgICBjb25zdCBtYXggPSAzMTtcbiAgICAgICAgICBjb25zdCBtaW4gPSAxO1xuICAgICAgICAgIGNvbnN0IG1heExlbmd0aCA9IDI7XG4gICAgICAgICAgaWYgKHZhbC5sZW5ndGggPiBtYXhMZW5ndGggfHwgdmFsIDwgbWluIHx8IHZhbCA+IG1heCkge1xuICAgICAgICAgICAgdmFsaWRhdGlvbltpXSA9IHtcbiAgICAgICAgICAgICAgaW5kZXg6IGksXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdFbnRlciBhIHZhbGlkIGRhdGUnLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobGFiZWwgPT09ICdZWVlZJykge1xuICAgICAgICAgIGNvbnN0IG1heCA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSArIDE7XG4gICAgICAgICAgY29uc3QgbWluID0gMTkyMDtcbiAgICAgICAgICBjb25zdCBtYXhMZW5ndGggPSA0O1xuICAgICAgICAgIGlmICh2YWwubGVuZ3RoID4gbWF4TGVuZ3RoIHx8IHZhbCA8IG1pbiB8fCB2YWwgPiBtYXgpIHtcbiAgICAgICAgICAgIHZhbGlkYXRpb25baV0gPSB7XG4gICAgICAgICAgICAgIGluZGV4OiBpLFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnRW50ZXIgYSB2YWxpZCB5ZWFyJyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB2YWxpZGF0aW9uO1xufTtcblxuY29uc3QgdmFsaWRhdGVGaWVsZCA9ICh2YWx1ZSwgZmllbGQpID0+IHtcbiAgY29uc3QgeyB0eXBlLCBpc1JlcXVpcmVkOiByZXF1aXJlZCB9ID0gZmllbGQ7XG4gIC8vIENoZWNrIGZpcnN0IGlmIHJlcXVyaWVkIGNoZWNrYm94IG9yIHJhZGlvXG4gIGlmICgodHlwZSA9PT0gJ2NoZWNrYm94JyB8fCB0eXBlID09PSAncmFkaW8nKSAmJiByZXF1aXJlZCkge1xuICAgIHJldHVybiBjaGVja2JveFZhbGlkYXRpb24odmFsdWUsIGZpZWxkLmVycm9yTWVzc2FnZSk7XG4gIH1cblxuICBpZiAodHlwZSA9PT0gJ3Bhc3N3b3JkJykge1xuICAgIHJldHVybiBwYXNzd29yZFZhbGlkYXRpb24odmFsdWUsIGZpZWxkKTtcbiAgfVxuXG4gIC8vIENoZWNrIGlmIGVtcHR5XG4gIGNvbnN0IGVtcHR5ID0gaXNFbXB0eSh2YWx1ZSk7XG4gIGxldCB2YWxpZGF0aW9uTWVzc2FnZSA9ICcnO1xuICBjb25zdCBtZXNzYWdlID0gZmllbGQgJiYgZmllbGQuZXJyb3JNZXNzYWdlID8gZmllbGQuZXJyb3JNZXNzYWdlIDogZmFsc2U7XG4gIC8vIFNldCB2YWxpZGF0aW9uIG1lc3NhZ2UgaWYgcmVxdWlyZWRcbiAgdmFsaWRhdGlvbk1lc3NhZ2UgPSByZXF1aXJlZCA/IGlzUmVxdWlyZWQocmVxdWlyZWQsIGVtcHR5LCBtZXNzYWdlKSA6IGZhbHNlO1xuICAvLyBTZXQgb3RoZXIgdmFsaWRhdGlvbiBtZXNzYWdlc1xuICBpZiAoIXZhbGlkYXRpb25NZXNzYWdlICYmICFlbXB0eSkge1xuICAgIGlmICh0eXBlID09ICdlbWFpbCcpIHtcbiAgICAgIHZhbGlkYXRpb25NZXNzYWdlID0gaXNFbWFpbCh2YWx1ZSlcbiAgICAgICAgPyBmYWxzZVxuICAgICAgICA6IGZpZWxkLmVycm9yTWVzc2FnZVxuICAgICAgICAgID8gZmllbGQuZXJyb3JNZXNzYWdlXG4gICAgICAgICAgOiAnRW50ZXIgYSB2YWxpZCBlbWFpbCc7XG4gICAgfSBlbHNlIGlmICh0eXBlID09ICd3ZWJzaXRlJykge1xuICAgICAgdmFsaWRhdGlvbk1lc3NhZ2UgPSBpc1VybCh2YWx1ZSlcbiAgICAgICAgPyBmYWxzZVxuICAgICAgICA6IGZpZWxkLmVycm9yTWVzc2FnZVxuICAgICAgICAgID8gZmllbGQuZXJyb3JNZXNzYWdlXG4gICAgICAgICAgOiAnRW50ZXIgYSB2YWxpZCB1cmwnO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnZGF0ZScpIHtcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSBpc0RhdGUodmFsdWUsIGZpZWxkKTtcbiAgICAgIHZhbGlkYXRpb25NZXNzYWdlID0gaXNWYWxpZC5sZW5ndGggPiAwID8gaXNWYWxpZCA6IGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdmFsaWRhdGlvbk1lc3NhZ2U7XG59O1xuXG5leHBvcnQge1xuICBpc0VtcHR5LCBzZWxlY3RWYWxpZGF0aW9uLCBjaGVja2JveFZhbGlkYXRpb24sIGlzVXJsLCBpc0VtYWlsLCBpc1JlcXVpcmVkLCB2YWxpZGF0ZUZpZWxkLFxufTtcbiJdfQ==